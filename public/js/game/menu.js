define(["./scenes","./network/connector","./network/creator","require","./menu"],function(d,f,k,l){var h=1;var i=1;function j(o){var n=l("./menu");student=n.readStudentCookie();$.ajax({url:"/loadGame",type:"POST",data:{email:student},dataType:"json",success:function(p){o(p)}})}function b(){var n=document.cookie.indexOf("token=")+"token=".length;var o=document.cookie.indexOf(";",n);if(o<0){o=document.cookie.length}return'<input type="hidden" value="'+document.cookie.substring(n,o)+'" name="_csrf" />'}function m(q,o,n){var p=q.length<=o;if(n>0){p=p&&(q.length>=n)}return p}function c(p,q,o){var n=/^(\ *[A-Za-zÁáÉéÍíÓóÚúÜüºª]+\ *)+$/;if(o){n=/^(\ *[A-Za-z0-9ÁáÉéÍíÓóÚúÜüºª]+\ *)+$/}if(!m(p,20,1)){return false}else{if(!q){return n.test(p)}else{return(p==="")||n.test(p)}}}function a(){var n="";var o=l("menu");if(h>1){n='<div class="buttonext" id="continue">Continuar</div>'}return['<div class="menu">','<div class="separator">En solitario</div>','<div class="buttonext" id="new">Nuevo juego</div>',n,"</div>",'<div class="extra">','<div id="edbutton">Atr&aacute;s</div>',"</div>"].join("\n")}function e(){return['<div class="menu">','<div class="separator">Con un amigo</div>','<div class="buttonext" id="create">Crear partida</div>','<div class="buttonext" id="connect">Entrar en una partida</div>',"</div>",'<div class="extra">','<div id="edbutton">Atr&aacute;s</div>',"</div>"].join("\n")}function g(){var n=l("menu");$("#create").bind("click",function(){n.createPanel()});$("#connect").bind("click",function(){n.connectPanel()});$("#edbutton").bind("click",function(){$(".container").empty();$(".container").append(n.getGamePanel());n.menuHandler()})}return{getGamePanel:function(){return['<div class="menu">','<div class="separator">Modo de juego</div>','<div class="buttonext" id="one">Un jugador</div>','<div class="buttonext" id="two">Dos jugadores</div>',"</div>",'<div class="extra">','<form method="GET" action="signout">',b(),'<input id="lobutton" type="submit" value="Salir"/>',"</form>","</div>"].join("\n")},menuHandler:function(){var n=l("menu");j(function(o){if(o){h=o.level}$("#one").bind("click",function(){$(".container").empty();$(".container").append(a());$("#new").bind("click",function(){var p=h;if(p>1){$("#edbutton").hide();$(".menu").hide();$(".container").before(['<div class="menu" id="sure">','<div class="separator">¿Empezar de nuevo?</div>',"<p>Vas por el nivel "+p+", seguro que quieres empezar desde el nivel 1?</p>",'<div class="buttonext" id="yes">Sí</div>','<div class="buttonext" id="no">No</div>',"</div>"].join("\n"));$("#yes").bind("click",function(){n.startGame(n.readStudentCookie(),i)});$("#no").bind("click",function(){$("#sure").remove();$(".menu").show();$("#edbutton").show()})}else{n.startGame(n.readStudentCookie(),i)}});$("#continue").bind("click",function(){n.startGame(n.readStudentCookie(),h)});$("#edbutton").bind("click",function(){$(".container").empty();$(".container").append(n.getGamePanel());n.menuHandler()})});$("#two").bind("click",function(){$(".container").empty();$(".container").append(e());g()})})},createPanel:function(){$(".container").empty();$(".container").append(['<div class="menu">','<div class="separator">Crear partida</div>','<input class="field" type="text" name="game" placeholder="Nombre de la partida"/>','<div class="buttonext" id="create">Crear</div>',"</div>",'<div class="extra">','<div id="edbutton">Atr&aacute;s</div>',"</div>"].join("\n"));$("#create").bind("click",function(){var n=$("input[name='game']").val();if(c(n,false,true)){$("body").unbind("keyup");k.startCreator(n)}});$("body").bind("keyup",function(o){if((o.keyCode||o.which)==13){var n=$("input[name='game']").val();if(c(n,false,true)){$("body").unbind("keyup");k.startCreator(n)}}});$("#edbutton").bind("click",function(){$("body").unbind("keyup");$(".container").empty();$(".container").append(e());g()})},connectPanel:function(){$(".container").empty();$(".container").append(['<div class="menu">','<div class="separator">Conectar</div>','<input class="field" type="text" name="game" placeholder="Nombre de la partida"/>','<div class="buttonext" id="connect">Conectar</div>',"</div>",'<div class="extra">','<div id="edbutton">Atr&aacute;s</div>',"</div>"].join("\n"));$("#connect").bind("click",function(){var n=$("input[name='game']").val();if(c(n,false,true)){$("body").unbind("keyup");f.startConnector(n)}});$("body").bind("keyup",function(o){if((o.keyCode||o.which)==13){var n=$("input[name='game']").val();if(c(n,false,true)){$("body").unbind("keyup");f.startConnector(n)}}});$("#edbutton").bind("click",function(){$("body").unbind("keyup");$(".container").empty();$(".container").append(e());g()})},waitingMenu:function(n){var o=['<div class="menu">','<div class="separator">Esperando...</div>','<p>Esperando a que tu amigo se conecte a "'+n+'"...</p>',"</div>",'<div class="extra">','<div id="edbutton">Atr&aacute;s</div>',"</div>"].join("\n");$(".container").empty();$(".container").append(o);$("#edbutton").bind("click",function(){$(".container").empty();$(".container").append(e());k.closeCreator(n);g()})},connectionMenu:function(n){var o=['<div class="menu">','<div class="separator">Conectando...</div>','<p>Conectando a la partida "'+n+'"...</p>',"</div>",'<div class="extra">','<div id="edbutton">Atr&aacute;s</div>',"</div>"].join("\n");$(".container").empty();$(".container").append(o);$("#edbutton").bind("click",function(){$(".container").empty();$(".container").append(e());f.closeConnector(n);g()})},startGame:function(n,p,o){$("body").empty();if(o===undefined){o={multi:"single"}}d.newGame(n,p,o.multi)},readStudentCookie:function(){var n=document.cookie.indexOf("student=")+"student=".length;var o=document.cookie.indexOf(";",n);if(o<0){o=document.cookie.length}return document.cookie.substring(n,o)},getLevel:function(){return h}}});