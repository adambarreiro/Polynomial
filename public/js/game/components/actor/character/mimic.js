define(["../../../network/connector","../../../network/creator","../../../multi","require","../../../scenes"],function(h,l,g,m){var j;var d,b;var e=true;function c(o){if(o.x===666&&o.y===666){Crafty("Multiplayer").pauseAnimation();Crafty("Multiplayer").sprite(0,0)}else{if(o.x===-666&&o.y===-666){Crafty("Multiplayer").pauseAnimation();Crafty("Multiplayer").sprite(1,0)}else{if(o.x===333&&o.y===333){Crafty("Multiplayer")._up=false;if(Crafty("Multiplayer")._orientation=="left"){Crafty("Multiplayer").sprite(1,0)}else{Crafty("Multiplayer").sprite(0,0)}}else{Crafty("Multiplayer").x=d=o.x;Crafty("Multiplayer").y=b=o.y}}}}function k(p){Crafty.audio.play("attack");Crafty.audio.play("monster_scream");var o;Crafty("Enemy").each(function(){if(this._id===p.enemy){o=this[0];return}});Crafty(o)._enemyHealth=Crafty(o)._enemyHealth-p.damage;if(Crafty(o)._enemyHealth>0){if(Crafty("Character")._battleFighting&&Crafty("Character")._detectionEnemy._id===Crafty(o)._id){$("#enemybar").css({width:Crafty(o)._enemyHealth*3+"px"})}}else{Crafty.audio.play("enemy_death");if(Crafty("Character")._battleFighting&&Crafty("Character")._detectionEnemy!==undefined&&Crafty("Character")._detectionEnemy._id===Crafty(o)._id){$($(".lifebox").children()[2]).hide();$($(".lifebox").children()[3]).hide();$("#enemybar").css({width:"300px"});Crafty("Character").clearBattle();Crafty.audio.stop("alert");Crafty.audio.stop("hidden");Crafty.audio.play("level",-1);if(Crafty("Character")._extraTime>0){Crafty("Character")._extraTime--;if(Crafty("Character")._extraTime===0){Crafty("Character").removeBonus("clock")}}Crafty("Character")._battleFighting=false;Crafty("Character").startAll()}Crafty(o).destroy()}}function a(){switch(j){case"connector":h.onReceiveMovement(c);break;case"creator":l.onReceiveMovement(c);break;default:break}}function f(){var o=m("../../../scenes");switch(j){case"connector":h.onReceiveExit(function(){Crafty("Character").stopAll();o.nextLevel()});break;case"creator":l.onReceiveExit(function(){Crafty("Character").stopAll();o.nextLevel()});break;default:break}}function n(){switch(j){case"connector":h.onReceiveDamage(k);break;case"creator":l.onReceiveDamage(k);break;default:break}}function i(){switch(j){case"connector":h.onReceiveUpdateHealth(function(p){if(p!==undefined){var q=Crafty("Enemy");for(var o=0;o<q.length;o++){if(p.healths[o]!==null){Crafty(q[o])._enemyHealth=p.healths[o]}else{Crafty(q[o]).destroy()}}}});break;case"creator":l.onReceiveUpdateHealth(function(p){if(p!==undefined){var q=Crafty("Enemy");for(var o=0;o<q.length;o++){if(p.healths[o]!==null){Crafty(q[o])._enemyHealth=p.healths[o]}else{Crafty(q[o]).destroy()}}}});break;default:break}}return{createComponent:function(o){Crafty.c("Mimic",{_multiJumped:false,multiplayerDamage:function(p,q){switch(j){case"connector":h.sendDamage(p,q);break;case"creator":l.sendDamage(p,q);break;default:break}},multiplayerExit:function(){switch(j){case"connector":h.sendExit();break;case"creator":l.sendExit();break;default:break}},multiplayerUpdateHealth:function(p){switch(j){case"connector":h.sendUpdateHealth(p);break;case"creator":l.sendUpdateHealth(p);break;default:break}},multiplayerMove:function(){var r,q,t,s;var p=false;switch(j){case"connector":this.bind("EnterFrame",function(){if(this._up){p=true}if(!this._up&&p){h.sendMovement(333,333);p=false}});this.bind("Moved",function(){Crafty("Multiplayer")._started=true;h.sendMovement(this.x,this.y)});this.bind("KeyUp",function(u){if(u.key===Crafty.keys.LEFT_ARROW){h.sendMovement(-666,-666);this.pauseAnimation();this.sprite(1,0)}else{if(u.key===Crafty.keys.RIGHT_ARROW){h.sendMovement(666,666);this.sprite(0,0)}}});break;case"creator":this.bind("EnterFrame",function(){if(this._up){p=true}if(!this._up&&p){l.sendMovement(333,333);p=false}});this.bind("Moved",function(){Crafty("Multiplayer")._started=true;l.sendMovement(this.x,this.y)});this.bind("KeyUp",function(u){if(u.key===Crafty.keys.LEFT_ARROW){l.sendMovement(-666,-666);this.pauseAnimation();this.sprite(1,0)}else{if(u.key===Crafty.keys.RIGHT_ARROW){l.sendMovement(666,666);this.sprite(0,0)}}});break;default:break}},connectorMode:function(){j="connector";a();f();n();i();this.multiplayerMove()},creatorMode:function(){j="creator";a();f();n();i();this.multiplayerMove()},init:function(){this.requires("Character")},restartMimic:function(){this.multiplayerMove()},getMultiPosition:function(){if(d!==undefined&&b!==undefined){return[d/32,b/32]}else{return[this.x/32,this.y/32]}},stopMultiplayer:function(){Crafty("Multiplayer").destroy();g.setMultiplayer("single");this.removeComponent("Mimic")},restartMultiFlags:function(){e=false},getMulti:function(){return g.getMultiplayer()}})}}});