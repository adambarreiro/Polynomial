define(["../../../audio"],function(a){var c={maxParticles:150,size:18,sizeRandom:4,speed:1,speedRandom:1.2,lifeSpan:29,lifeSpanRandom:7,angle:65,angleRandom:34,startColour:[255,131,0,1],startColourRandom:[48,50,45,0],endColour:[245,35,0,0],endColourRandom:[60,60,60,0],sharpness:20,sharpnessRandom:10,spread:10,duration:-1,fastMode:false,gravity:{x:0,y:0.1},jitter:0};var b=2;return{createComponent:function(d){Crafty.c("Lava",{_lavaInterval:undefined,_lavaFloor:undefined,_lavaParticles:0,_lavaScreams:0,lava:function(){this._lavaFloor=Crafty.map.search({_x:this.x+16,_y:this.y+32,_w:1,_h:1},true);if(this._lavaFloor.length>0){if(this._lavaFloor[0].has("Abyss")){if(this._lavaInterval===undefined){this._lavaParticles=0;this._lavaScreams=0;this._lavaInterval=setInterval(function(){Crafty.e("2D, Canvas, Particles").attr({x:Crafty("Character").x,y:Crafty("Character").y+16}).particles(c);Crafty("Character")._lavaParticles++;Crafty("Character")._lavaScreams++;Crafty("Character").damage("lava");if(Crafty("Character")._lavaParticles%b===0){Crafty("Particles").each(function(){this.destroy()})}},100)}}else{this.clearLava()}}},clearLava:function(){clearInterval(this._lavaInterval);Crafty("Particles").each(function(){this.destroy()});this._lavaInterval=undefined},init:function(){this.requires("Damage");this.bind("EnterFrame",function(){this.lava()});this.bind("Moved",function(){this.lava()})}})}}});