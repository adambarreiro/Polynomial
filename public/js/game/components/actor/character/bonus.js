define(["../../../audio"],function(b){var e=[];var h=[];var c=70;var f=3;var a=1;function d(l){var k="";var m=l.split("^");if(m.length>1){k+=m[0].concat("<sup>");for(i=1;i<m.length;i++){if(i<m.length-1){m[i]=m[i].concat("<sup>")}var n=m[i].search(/[^0-9]/);k+=m[i].substring(0,n)+"</sup>"+m[i].substring(n,m[i].length)}}else{k=l}return k}function j(k){$.ajax({url:"/getQuestionsFile",type:"POST",dataType:"html",success:function(p){var n=p.split("#");var o=[],l=[];for(var m=0;m<n.length-1;m++){if(m%2===0){o.push(d(n[m]))}else{l.push(n[m])}}k(o,l)}})}function g(l){var k=['<div class="popup">','<div class="separator">Perdiste el tesoro...</div>',"<p>La afirmación era "+l+"...</p>",'<input class="button" type="button" name="true" value="Maldición"/>',"</div>"].join("\n");$("#cr-stage").append(k);$("input").on("click",function(){Crafty("Character").startAll();$(".popup").remove()})}return{createComponent:function(){Crafty.c("Bonus",{item:function(){var o;var l;var m;var n=Math.random();if(n<0.5){o="SALUD";l="health";m="¡Notas como tu vida se restablece!"}else{if(n>=0.5&&n<0.666){o="POTENCIA";l="power";m="¡Tus próximos "+(+this._power+f)+" ataques serán críticos!"}else{if(n>=0.666&&n<0.835){o="ESCUDO";l="shield";m="¡Puedes soportar más daño!"}else{o="TIEMPO EXTRA";l="clock";m="¡En el próximo combate tendrás más tiempo!"}}}$(".popup").remove();var k=['<div class="popup">','<div class="separator">¡TESORO OBTENIDO!</div>',"<p>Has conseguido <strong>"+o+"</strong></p>","<p>"+m+"</p>",'<input class="button" type="button" name="true" value="Continuar"/>',"</div>"].join("\n");$("#cr-stage").append(k);$("input").on("click",function(){$(".popup").remove();if(o!=="SALUD"){if($("#"+l).length===0){$(".inventory").append('<div class="element" id="'+l+'"></div>');$("#"+l).css({background:"url('/assets/img/game/items/"+l+".png') no-repeat"})}}switch(l){case"health":b.playHealth();Crafty("Character")._health=Crafty("Character")._health+Math.floor(Math.random()*(100-c+1)+c);if(Crafty("Character")._health>100){Crafty("Character")._health=100}$("#lifebar").css({width:(Crafty("Character")._health*3)+"px"});break;case"shield":b.playShield();Crafty("Character")._shield=100;$("#lifebar").css({width:"300px",background:"rgb(50,50,200)"});$("#vidatext").html("Escudo: ");break;case"power":b.playPower();Crafty("Character")._power=Crafty("Character")._power+f;break;case"clock":b.playClock();Crafty("Character")._clocks=Crafty("Character")._clocks+a;break}Crafty("Character").startAll()})},treasure:function(){var q=Crafty.map.search({_x:this.x+15,_y:this.y,_w:1,_h:32},true);if(q.length>1){var k;for(var o=0;o<q.length;o++){if(q[o].has("Chest")){k=q[o];break}}if(k!==undefined){if(!k._opened){this.stopAll();b.playChest();k._opened=true;k.sprite(1,0);if(e.length===0||h.length===0){return}var l=(Math.floor(Math.random()*e.length));var n=['<div class="popup">','<div class="separator">¡TESORO ENCONTRADO!</div>',"<p>"+e[l]+"</p>",'<input class="button" type="button" name="true" value="Verdadero"/>','<input class="button" type="button" name="false" value="Falso"/>',"</div>"].join("\n");$("#cr-stage").append(n);var m=false;$("input[name=true]").on("click",function(){if(h[l]=="V"){Crafty("Character").item()}else{g("falsa")}});$("input[name=false]").on("click",function(){if(h[l]=="F"){Crafty("Character").item()}else{g("verdadera")}})}}}},removeBonus:function(k){$("#"+k).remove()},init:function(){if(e.length===0&&h.length===0){j(function(l,k){e=l;h=k})}this.bind("KeyDown",function(){if(this.isDown("S")){this.treasure()}})}})}}});