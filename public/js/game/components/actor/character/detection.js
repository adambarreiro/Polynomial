define(["../../../audio"],function(a){return{createComponent:function(b){Crafty.c("Detection",{_detectionEnemy:undefined,_detectionSpotted:false,_detectionReachable:false,_detectionHidden:false,detection:function(){var h;if(this._up){h=Crafty.map.search({_x:this.x-320,_y:this.y,_w:640,_h:64},true)}else{h=Crafty.map.search({_x:this.x-320,_y:this.y,_w:640,_h:32},true)}if(this.hit("Hide")){this._detectionHidden=true}else{this._detectionHidden=false}var f,e;for(var g=0;g<h.length;g++){if(h[g].has("Enemy")){if(this._detectionEnemy===undefined){this._detectionEnemy=h[g]}else{if(Math.abs(this.x-h[g].x)<Math.abs(this.x-this._detectionEnemy.x)){this._detectionEnemy=h[g]}}}if(h[g].has("Terrain")){if(f===undefined){if(this.x>h[g].x){f=h[g]}}else{if((this.x>h[g].x)&&(Math.abs(this.x-h[g].x)<Math.abs(this.x-f.x))){f=h[g]}}if(e===undefined){if(this.x<h[g].x){e=h[g]}}else{if((this.x<h[g].x)&&(Math.abs(this.x-h[g].x)<Math.abs(this.x-e.x))){e=h[g]}}}}if(this._detectionEnemy!==undefined){var c=false;var j;if(e!==undefined){if(this.x<e.x&&e.x<this._detectionEnemy.x){c=true;this._detectionReachable=false}}if(f!==undefined){if(this.x>f.x&&f.x>this._detectionEnemy.x){c=true;this._detectionReachable=false}}if(!c){if(this._detectionEnemy.getOrientation()==="left"){if(this.x<this._detectionEnemy.x){j=Math.abs(this.x-this._detectionEnemy.x);if(j<128&&!this._detectionHidden){this._detectionSpotted=true}else{this._detectionSpotted=false;if(j<128){this._detectionReachable=true}else{this._detectionReachable=false}}}else{j=Math.abs(this.x-this._detectionEnemy.x);if(j<128){this._detectionReachable=true}else{this._detectionReachable=false}this._detectionSpotted=false}}else{if(this._detectionEnemy.x<=this.x){j=Math.abs(this.x-this._detectionEnemy.x);if(j<128&&!this._detectionHidden){this._detectionSpotted=true}else{this._detectionSpotted=false;if(j<128){this._detectionReachable=true}else{this._detectionReachable=false}}}else{j=Math.abs(this.x-this._detectionEnemy.x);if(j<128){this._detectionReachable=true}else{this._detectionReachable=false}this._detectionSpotted=false}}}if(this._detectionHidden){if(this._detectionReachable){$("#timeout").css({color:"cyan","border-color":"cyan"});$("#timeout").html("¡ESTÁS ESCONDIDO Y PUEDES ATACAR!")}else{$("#timeout").css({color:"#33FF33","border-color":"#33FF33"});$("#timeout").html("¡ESTÁS ESCONDIDO! ESPERA PARA ATACAR...")}}else{if(c){$("#timeout").css({color:"white","border-color":"white"});$("#timeout").html("SIN PELIGRO")}else{if(this._detectionSpotted){$("#timeout").css({color:"red","border-color":"red"});$("#timeout").html("ALERTA MÁXIMA, ¡TE HAN PILLADO!")}else{$("#timeout").css({color:"yellow","border-color":"yellow"});if(this._detectionReachable){$("#timeout").html("¡¡ENEMIGO MUY CERCA, ATACA O ESCÓNDETE!!")}else{$("#timeout").html("¡CUIDADO, ENEMIGO A LA VISTA!")}}}}}else{if(!this._detectionHidden){$("#timeout").css({color:"white","border-color":"white"});$("#timeout").html("SIN PELIGRO")}else{$("#timeout").css({color:"#33FF33","border-color":"#33FF33"});$("#timeout").html("¡ESTÁS ESCONDIDO! ESPERA PARA ATACAR...")}}if(this._detectionSpotted&&!this._battleFighting){this._detectionSpotted=false;a.playLevel();a.playAlert();this.battle(true)}else{if(!this._detectionHidden&&!this._detectionReachable){this._detectionEnemy=undefined}}},init:function(){this.requires("Battle");this.bind("KeyDown",function(){if(this.isDown("A")){if(this._detectionReachable){a.playLevel();if(!this._detectionHidden){a.playAlert();this.battle(true)}else{a.playHidden();this.battle(false)}}}});this.bind("EnterFrame",function(){this.detection()})}})}}});