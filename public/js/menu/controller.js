define(["./view","require","./controller"],function(b,j){function k(p,n,m){var o=p.length<=n;if(m>0){o=o&&(p.length>=m)}return o}function i(m){if(!k(m,b.getFieldLimitsMax(),-1)){return false}else{return(/^[A-Za-z0-9\_\-\.]+\@[A-Za-z0-9\_\-\.]+(\.[A-Za-z0-9]{1,3})$/).test(m)}}function e(o,p,n){var m=/^(\ *[A-Za-zÁáÉéÍíÓóÚúÜüºª]+\ *)+$/;if(n){m=/^(\ *[A-Za-z0-9ÁáÉéÍíÓóÚúÜüºª]+\ *)+$/}if(!k(o,b.getFieldLimitsMax(),-1)){return false}else{if(!p){return m.test(o)}else{return(o==="")||m.test(o)}}}function l(m){return k(m,b.getFieldLimitsMax(),b.getFieldLimitsMin())}function g(n,m){if(n===m){if(l(n)){return true}}return false}function d(m){return !isNaN(parseFloat(m))&&isFinite(m)}function h(m){var n=j("controller");m.find(":button").bind("click",function(){m.empty();m.append(b.adminGetPanel());n.adminSetHandlers(m)})}function c(o){var n=o.find("form");var m=o.find("input[name='name']");n.on("submit",function(p){var q=false;if(!e(m.val(),false,true)){q=true;b.fieldError(m);b.fieldRestore(m)}if(q){q=false;p.preventDefault()}});h(o)}function a(p){var o=p.find("form");var m=p.find("input[name='name']");var q=p.find("input[name='password']");var n=p.find("input[name='password2']");o.on("submit",function(r){var s=false;if(!e(m.val(),false,true)){s=true;b.fieldError(m);b.fieldRestore(m)}if(!g(q.val(),n.val())){s=true;b.fieldError(q);b.fieldError(n);b.fieldRestore(q);b.fieldRestore(n)}if(s){s=false;r.preventDefault()}});h(p)}function f(){var m=content.find("select");var n=j("controller");m.change(function(){n.ajaxGetStudent($(this).val(),function(o){b.setViewStudent(o)})});h(content)}return{loginSetHandlers:function(q){var p=q.find("form");var m=q.find(":text");var o=q.find(":password");var n=q.find(":button");n.bind("click",function(){window.location="/register"});p.on("submit",function(r){var s=false;if(!i(m.val())&&!e(m.val(),false,true)){s=true;b.fieldError(m);b.fieldRestore(m)}if(!l(o.val())){s=true;b.fieldError(o);b.fieldRestore(o)}if(s){s=false;r.preventDefault()}})},registerSetHandlers:function(t){var p=t.find("form");var q=t.find(":button");var v=t.find("input[name='email']");var o=t.find("input[name='password']");var n=t.find("input[name='password2']");var u=t.find("input[name='name']");var s=t.find("input[name='surname1']");var r=t.find("input[name='surname2']");var m=t.find("select[name='group']");q.bind("click",function(){window.location="/login"});p.on("submit",function(w){var x=false;if(!i(v.val())){x=true;b.fieldError(v);b.fieldRestore(v)}if(!g(o.val(),n.val())){x=true;b.fieldError(o);b.fieldError(n);b.fieldRestore(o);b.fieldRestore(n)}if(!e(u.val(),false,false)){x=true;b.fieldError(u);b.fieldRestore(u)}if(!e(s.val(),false,false)){x=true;b.fieldError(s);b.fieldRestore(s)}if(!e(r.val(),true,false)){x=true;b.fieldError(r);b.fieldRestore(r)}if(m.val()===" "){x=true;b.fieldError(m);b.fieldRestore(m)}if(x){x=false;w.preventDefault()}})},registerIndicationsPopup:function(n){var m=n.find(".field");m.each(function(o,p){$(p).on("mouseover",function(){b.registerPopupsOn($(p),$(p).attr("name"))});$(p).on("mouseleave",function(q){b.registerPopupsOff()})})},adminSetHandlers:function(m){var n=j("controller");m.find("#createGroup").bind("click",function(){m.empty();m.append(b.adminCreateGroup());c(m)});m.find("#editGroup").bind("click",function(){b.loadingPopup(m);n.ajaxGetGroups(function(o){m.empty();m.append(b.adminEditGroup());b.setGroupList(o);c(m)})});m.find("#deleteGroup").bind("click",function(){b.loadingPopup(m);n.ajaxGetGroups(function(o){m.empty();m.append(b.adminDeleteGroup());b.setGroupList(o);h(m)})});m.find("#assignGroup").bind("click",function(){b.loadingPopup(m);n.ajaxGetStudents(false,function(o){n.ajaxGetGroups(function(p){m.empty();m.append(b.adminAssignGroup());b.setGroupList(p);b.setStudentList(o);h(m)})})});m.find("#disposeGroup").bind("click",function(){b.loadingPopup(m);n.ajaxGetStudents(true,function(o){m.empty();m.append(b.adminDisposeGroup());b.setStudentList(o);h(m)})});m.find("#viewStudent").bind("click",function(){b.loadingPopup(m);n.ajaxGetStudents(null,function(o){m.empty();m.append(b.adminViewStudent());b.setStudentList(o);f(m)})});m.find("#deleteStudent").bind("click",function(){b.loadingPopup(m);n.ajaxGetStudents(null,function(o){m.empty();m.append(b.adminDeleteStudent());b.setStudentList(o);h(m)})});m.find("#editAdmin").bind("click",function(){m.empty();m.append(b.adminEditAdmin());a(m)});$("body").find("#edbutton").bind("click",function(){window.location="/editor"})},getParameters:function(){b.showMessage(window.location.search.replace("?",""))},csrfAjax:function(){var m=document.cookie.indexOf("token=")+"token=".length;var n=document.cookie.indexOf(";",m);if(n<0){n=document.cookie.length}jQuery.ajaxPrefilter(function(p,o,q){if(!q.crossDomain){q.setRequestHeader("X-CSRF-Token",document.cookie.substring(m,n))}})},ajaxGetGroups:function(m){$.ajax({url:"/getGroups",type:"GET",dataType:"json",success:function(n){m(n)}})},ajaxGetStudents:function(m,n){if(m!==null){if(m){$.ajax({url:"/getStudentsWithGroup",type:"GET",dataType:"json",success:function(o){n(o)}})}else{$.ajax({url:"/getStudentsWithNoGroup",type:"GET",dataType:"json",success:function(o){n(o)}})}}else{$.ajax({url:"/getAllStudents",type:"GET",dataType:"json",success:function(o){n(o)}})}},ajaxGetStudent:function(m,n){$.ajax({url:"/getStudent",type:"POST",data:{email:m},dataType:"json",success:function(o){n(o)}})}}});